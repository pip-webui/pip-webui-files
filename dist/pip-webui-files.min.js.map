{"version":3,"sources":["../node_modules/browser-pack/_prelude.js","src/dependencies/translate.ts","src/files.ts","src/progress/FileProgressController.ts","src/select/FileSelectController.ts","src/service/FileUploadService.ts","temp/pip-webui-files-html.min.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","pip","files","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","1","thisModule","angular","filter","$injector","pipTranslate","has","get","key","translate","FileSelectController_1","FileProgressController_1","FileUploadService_1","fileModelDirective","$parse","restrict","scope","element","attrs","model","fileModel","modelSetter","assign","bind","$apply","fileSelectDirective","replace","localFile","controller","FileSelectController","controllerAs","templateUrl","fileProgressDirective","FileProgressController","cancel","retry","name","state","type","$inject","directive","service","FileUploadService","$scope","pipFileUpload","_this","_cancel","_retry","$watch","_service","prototype","errorFail","error","localProgress","progress","onCancel","onRetry","abort","4","item","onUploadButtonClick","$","click","onDeleteButtonClick","forml","document","getElementById","reset","5","GlobalProgress","All","Start","Upload","Fail","$http","pipTransaction","_http","transaction","create","upload","url","file","callback","fd","FormData","append","begin","lengthComputable","loaded","total","headers","Content-Type","undefined","response","globalProgress","end","6","run","$templateCache","put"],"mappings":"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","file":"pip-webui-files.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n * @file Optional filter to translate string resources\r\n * @copyright Digital Living Software Corp. 2014-2016\r\n */\r\n \r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module('pipFiles.Translate', []);\r\n\r\n    thisModule.filter('translate', function ($injector) {\r\n        var pipTranslate = $injector.has('pipTranslate') \r\n            ? $injector.get('pipTranslate') : null;\r\n\r\n        return function (key) {\r\n            return pipTranslate  ? pipTranslate.translate(key) || key : key;\r\n        }\r\n    });\r\n\r\n})();\r\n","ï»¿\r\nimport {FileSelectController} from './select/FileSelectController';\r\nimport {FileProgressController} from './progress/FileProgressController';\r\nimport {FileUploadService} from './service/FileUploadService';\r\n\r\n(() => {\r\n    function fileModelDirective($parse: any) {\r\n        \"ngInject\";\r\n\r\n        return {\r\n            restrict: 'A',\r\n            link: (scope, element, attrs) => {\r\n                let model = $parse(attrs.fileModel);\r\n                let modelSetter = model.assign;\r\n                \r\n                element.bind('change', () => {\r\n                    scope.$apply(() => {\r\n                        modelSetter(scope, element[0].files[0]);\r\n                    });\r\n                });\r\n            }\r\n        };\r\n    }\r\n\r\n    function fileSelectDirective() {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            scope: {\r\n                localFile: '='\r\n            },\r\n            controller: FileSelectController,\r\n            controllerAs: 'vm',\r\n            templateUrl: 'select/FileSelect.html'\r\n        };\r\n    }\r\n\r\n     function fileProgressDirective() {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            controller: FileProgressController,\r\n            controllerAs: 'vm',\r\n            scope: {\r\n                cancel: '=pipCancel',\r\n                retry: '=pipRetry' ,\r\n                name: '=pipName',\r\n                state: '=pipState',\r\n                type: '=?pipType'\r\n            },\r\n            templateUrl: 'progress/FileProgress.html'\r\n        };\r\n    }\r\n\r\n    angular\r\n        .module('pipFiles', [])\r\n        .directive('fileModel', fileModelDirective)\r\n        .directive('pipFileSelect', fileSelectDirective)\r\n        .directive('pipFileProgress', fileProgressDirective)\r\n        .service('pipFileUpload', FileUploadService);\r\n\r\n\r\n})();\r\n","\r\nimport {\r\n    IFileUploadService\r\n} from \"../service/FileUploadService\";\r\n\r\nexport interface IFileProgressController {\r\n    name: string;\r\n    type: string;\r\n    localProgress(): number;\r\n    onCancel(): void;\r\n    onCancel(): void;\r\n    abort(): void;\r\n}\r\n\r\nexport class FileProgressController implements IFileProgressController {\r\n    private _service: IFileUploadService;\r\n    private _cancel: Function;\r\n    private _retry: Function;\r\n    \r\n    public name: string;\r\n    public type: string;\r\n    public state: string;\r\n\r\n    constructor(\r\n        $scope: ng.IScope, \r\n        pipFileUpload: IFileUploadService\r\n    ) {\r\n        \"ngInject\";\r\n        \r\n        // Init parameters\r\n        this.type = $scope['type'] || 'file';\r\n        this._cancel = $scope['cancel'];\r\n        this._retry = $scope['retry'];\r\n        this.name = $scope['name'];\r\n        this.state = $scope['state'];\r\n\r\n        $scope.$watch('state', (state: string) => {\r\n            this.state = state;\r\n        })\r\n\r\n        this._service = pipFileUpload;\r\n    }\r\n\r\n    public errorFail(): string {\r\n        return this._service.error;\r\n    }\r\n\r\n    public localProgress(): number {\r\n        return this._service.progress;\r\n    }\r\n\r\n    public onCancel(): void {\r\n        if (this._cancel) this._cancel();\r\n    }\r\n\r\n    public onRetry(): void {\r\n        if (this._retry) this._retry();\r\n    }\r\n\r\n    public abort() {\r\n        this._service.abort();\r\n        if (this._cancel) this._cancel();\r\n    }\r\n\r\n}","export interface IFileSelectController {\r\n    localFile: any;\r\n    onUploadButtonClick(): void ;\r\n    onDeleteButtonClick(): void;\r\n}\r\n\r\nexport class FileSelectController implements IFileSelectController {\r\n    public localFile: any;\r\n    \r\n    constructor($scope: ng.IScope) {\r\n        \"ngInject\";\r\n        this.localFile = $scope['localFile'];\r\n        $scope.$watch('vm.localFile', (item) => {\r\n            $scope['localFile'] = item;\r\n        }) \r\n    }\r\n\r\n    public onUploadButtonClick(): void {\r\n        $('#inp_file').click();\r\n    }\r\n\r\n    public onDeleteButtonClick(): void {\r\n        this.localFile = null;\r\n        let forml = document.getElementById('inp_form');\r\n        (<any>forml).reset();\r\n\r\n    }\r\n}","export class GlobalProgress {\r\n    public static All: string[] = ['start', 'upload', 'fail'];\r\n    public static Start: string = 'start';\r\n    public static Upload: string = 'upload';\r\n    public static Fail: string = 'fail';\r\n}\r\n\r\nexport interface IFileUploadService {\r\n    progress: number;\r\n    globalProgress: string;\r\n    error: string;\r\n    transaction;//: pip.services.Transaction;\r\n    upload(url: string, file: any, callback?: (data: any, err: any) => void): void;\r\n    abort(): void;\r\n}\r\n\r\nexport class FileUploadService implements IFileUploadService {\r\n    private _http: ng.IHttpService;\r\n\r\n    public progress: number;\r\n    public globalProgress: string;\r\n    public error: string = null;\r\n    public transaction;//: pip.services.Transaction;\r\n\r\n    public constructor(\r\n        $http: ng.IHttpService,\r\n        pipTransaction//: pip.services.ITransactionService\r\n    ) {\r\n        \"ngInject\";\r\n\r\n        this._http = $http;\r\n        this.transaction = pipTransaction.create('upload file');\r\n    }\r\n\r\n    public upload(url: string, file: any, callback?: (data: any, err: any) => void): void {\r\n        //console.log(file); \r\n\r\n        let fd = new FormData();\r\n        fd.append('file', file);\r\n        \r\n        this.progress = 0;\r\n        this.transaction.begin(GlobalProgress.Start);\r\n        this.globalProgress = GlobalProgress.Start;\r\n        this._http.post(url, fd, <any>{\r\n            uploadEventHandlers: {\r\n                progress: (e: any) => {\r\n                    if (e.lengthComputable) {\r\n                        this.progress = (e.loaded / e.total) * 100;\r\n                    }\r\n                }\r\n            },\r\n            headers: { 'Content-Type': undefined }\r\n        })    \r\n        .success((response: any) => {\r\n            this.globalProgress = GlobalProgress.Upload;\r\n            this.transaction.end(GlobalProgress.Upload);\r\n\r\n            if (callback) callback(response, null);\r\n        })    \r\n        .error((response: any) => {\r\n            this.globalProgress = GlobalProgress.Fail;\r\n            this.transaction.end(GlobalProgress.Fail);\r\n            this.error = response.Error || response;\r\n\r\n            if (callback) callback(null, response);\r\n        });\r\n    }\r\n\r\n    public abort(): void {\r\n        this.transaction.abort();\r\n        //this.globalProgress = null;\r\n    }\r\n\r\n\r\n}","(function(module) {\ntry {\n  module = angular.module('pipFiles.Templates');\n} catch (e) {\n  module = angular.module('pipFiles.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('progress/FileProgress.html',\n    '<div class=\"pip-files pip-progress-files\"><div class=\"pip-body pip-scroll pip-progress-body\"><div class=\"layout-row\"><div class=\"pip-progress-icon\" ng-class=\"{\\'color-badge-bg\\': vm.state == \\'fail\\', \\'bb-orange\\': vm.state == \\'start\\', \\'bb-green\\': vm.state == \\'upload\\' }\"><md-icon md-svg-icon=\"icons:check\" ng-if=\"vm.state == \\'upload\\'\"></md-icon><md-icon md-svg-icon=\"bootbarn-icons:play\" ng-if=\"vm.state == \\'start\\'\"></md-icon><md-icon md-svg-icon=\"icons:cross\" ng-if=\"vm.state == \\'fail\\'\"></md-icon></div><div class=\"pip-progress-content\"><h3 class=\"pip-title\" ng-if=\"vm.state == \\'start\\'\">Uploading {{vm.type}}</h3><h3 class=\"pip-title\" ng-if=\"vm.state == \\'upload\\'\">Uploaded {{vm.type}} successfully!</h3><h3 class=\"pip-title\" ng-if=\"vm.state == \\'fail\\'\">Uploading {{vm.type}} failed with errors!</h3><div class=\"color-secondary-text pip-subtitle\">{{vm.name}}</div><div class=\"color-error pip-error\" ng-if=\"vm.state == \\'fail\\'\">{{vm.errorFail()}}</div><div ng-if=\"vm.state == \\'start\\'\"><md-progress-linear md-mode=\"determinate\" class=\"md-accent\" value=\"{{vm.localProgress()}}\" ng-if=\"vm.localProgress() < 100\"></md-progress-linear><md-progress-linear md-mode=\"indeterminate\" class=\"md-accent\" ng-if=\"vm.localProgress() == 100\"></md-progress-linear></div></div></div></div><div class=\"pip-footer layout-row layout-align-end-center\"><div><md-button class=\"md-accent\" ng-click=\"vm.onCancel()\" ng-show=\"!vm.state || vm.state == \\'fail\\'\">Cancel</md-button><md-button class=\"md-accent\" ng-click=\"vm.onRetry()\" ng-show=\"vm.state == \\'fail\\'\">Retry</md-button><md-button class=\"md-accent\" ng-click=\"vm.abort()\" ng-show=\"vm.state == \\'start\\'\">Abort</md-button></div></div></div>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipFiles.Templates');\n} catch (e) {\n  module = angular.module('pipFiles.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('select/FileSelect.html',\n    '<div class=\"pip-file-select\"><form id=\"inp_form\" class=\"pip-hidden-form\"><input type=\"file\" file-model=\"vm.localFile\" id=\"inp_file\" ng-model=\"vm.localFile\"></form><md-button class=\"md-raised md-accent pip-button\" ng-click=\"vm.onUploadButtonClick()\" ng-if=\"!vm.localFile\">Choose File</md-button><div ng-if=\"vm.localFile.name\" class=\"pip-file layout-row layout-align-start-center\"><md-icon md-svg-icon=\"icons:document\" class=\"pip-icon\"></md-icon><div class=\"flex\"><div class=\"text-body2 text-overflow\">{{vm.localFile.name}}</div><div ng-if=\"vm.localFile.size\" class=\"color-secondary-text\">{{vm.localFile.size}}</div></div><md-button ng-click=\"vm.onDeleteButtonClick()\" class=\"md-icon-button\"><md-icon md-svg-icon=\"icons:cross-circle\"></md-icon></md-button></div></div>');\n}]);\n})();\n\n//# sourceMappingURL=pip-webui-files-html.min.js.map\n"]}